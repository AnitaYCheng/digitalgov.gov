{{/*

  Collection List Item
  Returns a list item variant for USWDS Collection

  $href: collection header link
  $logo_source: logo path or url
  $variant: default, media, headings, calendar
  $meta_source: is the referring source link for headings variant,
  $list_header: accepts a header value
    3 = h3
    4 = h4

*/}}
{{ $variant := .variant }}
{{ $meta_source := .meta_source }}
{{ $href := .href }}
{{ $link_external := false }}
{{ $logo_source := .logo_source }}
{{ $list_header := .list_header }}


{{ $url := urls.Parse $href }}

{{/*  Check if external link  */}}
{{ if ne $url.Host "www.digital.gov" }}
  {{ $link_external = true }}
{{ end }}

{{- with .item -}}
  {{ $path := "" }}{{ with .File }}
    {{ $path = .Path }}
  {{ else }}
    {{ $path = .Path }}
  {{ end }}


  <li class="usa-collection__item" data-edit-this="{{- $path -}}">
    {{ if eq $variant "media" }}
      {{- partial "partials/core/collection-icon" (dict "item" . "logo_source" $logo_source) -}}
    {{ end }}
    <div class="usa-collection__body">
      <!-- prettier-ignore -->
      <h{{ $list_header | safeHTML }} class="usa-collection__header">
        <a class="usa-link {{ if $link_external }}usa-link--external{{ end }}" href="{{- $href -}}" title="{{- .Title | markdownify -}}">
          {{- .Title | markdownify -}}
        </a>
      </h{{ $list_header | safeHTML }}>
      {{ if or (eq $variant "default") (eq $variant "media") }}
        <p class="usa-collection__description">
          {{- if .Params.summary -}}
            {{- .Params.summary | markdownify | truncate 140 -}}
          {{- else -}}
            {{- .Params.deck | markdownify -}}
          {{- end -}}
        </p>
      {{ else if eq $variant "headings" }}
        {{ if $meta_source }}
          <ul class="usa-collection__meta" aria-label="More information">
            <li class="usa-collection__meta-item position-relative">
              <svg
                class="usa-icon position-relative bottom-neg-2px"
                aria-hidden="true"
                role="img"
              >
                <use
                  xlink:href="{{ "uswds/img/sprite.svg#public" | relURL }}"
                ></use>
              </svg>
              {{- $meta_source -}}
            </li>
          </ul>
        {{ end }}
      {{ end }}
    </div>
  </li>
{{- end -}}

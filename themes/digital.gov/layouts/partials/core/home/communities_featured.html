{{/* Gets all communities pages */}}
{{ $dg_communities := (where .context.Site.Pages "Section" "communities").ByTitle }}

{{/* Gather only the pages with a weight greater than or equal to 1 */}}
{{ $dg_communities := (where $dg_communities ".Params.weight" "ge" 1) }}

{{/* Gather only the pages with a dg-emphasis key */}}
{{ $dg_communities := (where $dg_communities ".Params.dg_highlight" "eq" true) }}


<div class="grid-container-desktop">
  <header
    class="page-head {{ cond (eq .community_page "home") "communities__home-title" "" }}"
  >
    {{- with .community_title -}}
      <h2>{{ . | markdownify }}</h2>
    {{- end -}}
    {{- with .community_deck -}}
      <p>
        {{ . | markdownify }}
      </p>
    {{- end -}}
  </header>
</div>
<section class="usa-section">
  {{ if eq .community_page "main" }}
    <div class="grid-container-desktop">
      <div class="grid-row tablet-lg:grid-gap-2">
        <div class="grid-col-12">
          <ul class="usa-card-group">
            {{ range $i, $e := $dg_communities }}
              <li
                class="usa-card tablet:grid-col-4 {{ if $e.Params.dg_acronym }}
                  cop-card--{{ $e.Params.dg_acronym }}
                {{ end }}"
              >
                <div class="usa-card__container">
                  <div class="usa-card__header">
                    <h2 class="usa-card__heading">
                      {{- $e.Params.dg_shortname | markdownify -}}
                    </h2>
                  </div>
                  <div class="usa-card__body">
                    <p>{{- $e.Params.summary | markdownify -}}</p>
                  </div>
                  <div class="usa-card__footer">
                    <a
                      class="usa-button"
                      href="{{- $e.Permalink -}}"
                      title="{{- $e.Params.dg_shortname -}}"
                    >
                      Connect with <br />{{ $e.Params.dg_shortname }}
                    </a>
                  </div>
                </div>
              </li>
            {{ end }}
          </ul>
        </div>
      </div>
    </div>
  {{ else }}
    <div class="communities__home">
      {{ range $i, $e := $dg_communities }}
        <div
          class="usa-card{{ if $e.Params.dg_acronym }}
            cop-card--{{ $e.Params.dg_acronym }}
          {{ end }} home"
        >
          <div class="usa-card__container">
            <div class="usa-card__header">
              <h2 class="usa-card__heading">
                {{- $e.Params.dg_shortname | markdownify -}}
              </h2>
            </div>
            <div class="usa-card__body">
              <p>{{- $e.Params.summary | markdownify -}}</p>
            </div>
            <div class="usa-card__footer">
              <a
                class="usa-button"
                href="{{- $e.Permalink -}}"
                title="{{- $e.Params.dg_shortname -}}"
              >
                Connect with <br />{{ $e.Params.dg_shortname }}
              </a>
            </div>
          </div>
        </div>
      {{ end }}
    </div>
  {{ end }}
</section>

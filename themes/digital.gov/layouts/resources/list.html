{{- define "content" -}}
{{ $path := "" }}{{ with .File }}{{ $path = .Path }}{{ else }}{{ $path = .Path }}{{ end }}

<main role="main" id="main-content" class="main-resources">
  <article>
    <header class="page-head page-head-{{- .Type -}}">
      <div class="grid-container grid-container-desktop">
        <div class="grid-row">
          <div class="grid-col-12" data-edit-this="{{- $path -}}">

            {{/* Page Title */}}
            <h1>{{- .Title | markdownify -}} </h1>

            {{/* Deck */}}
            {{- if .Params.deck -}}
            <div class="deck">{{- .Params.deck | markdownify | emojify -}}</div>
            {{- end -}}

            {{/* {{ partial "last-updated.html" . }} */}}
          </div>
        </div>

        <div class="grid-row">
          <div class="grid-col-12">

            {{- partial "core/search-bar.html" . -}}

          </div>
        </div>

      </div>
    </header>


    {{/* Popular Resources */}}
    <section class="usa-section" id="resources_featured">
      <div class="grid-container grid-container-desktop">
        <div class="grid-row">
          <div class="grid-col-12 tablet-lg:grid-col-10">

            {{/* Get all of the resources */}}
            {{- $resources := (where .Site.Pages.ByTitle "Section" "resources") -}}

            {{/* Get only the pages that are greater than or equal to 3 */}}
            {{- $resourcesfeatured := (where $resources ".Params.weight" "ge" 3 ) -}}

            {{/* Sort all of the resources by weight */}}
            {{- $resourcesfeatured := (sort $resourcesfeatured "Weight" "desc" ) -}}

            {{/* Pass $resourcesfeatured to the collection template */}}
            {{- partial "core/collection.html" (dict "list" $resourcesfeatured "heading" "Popular Guides and Resources") -}}

          </div>
        </div>
      </div>
    </section>


    {{/* Resources Listed by Topic */}}
    {{- $page := .Page -}}
    <section class="usa-section" id="resources_by_topic">
      <div class="grid-container grid-container-desktop">

        <div class="grid-row">
          <div class="grid-col-12">
            <h2>All Resources by Topic</h2>
          </div>
        </div>
        <div class="grid-row grid-gap-4">

          <div class="grid-col-12 tablet:grid-col-9">

            {{/* Gets all the pages in the /topics directory */}}
            {{- with ($.Site.GetPage (printf "/%s" "topics")) -}}

              {{/* Get only the pages that are greater than or equal to 2 */}}
              {{- $topics_featured := (where .Pages ".Params.weight" "ge" 2 ) -}}

              {{/* Loop through all the topics... */}}
              {{ range $name, $taxonomy := $topics_featured }}

                {{/* Get all resource pages with this current taxonomy */}}
                {{- $resources_by_topic := (where .Pages "Section" "resources") -}}

                {{/* If there are resources... */}}
                {{- if $resources_by_topic -}}
                <div class="topic-section">
                  <div class="grid-row">
                    <div class="grid-col-12">
                      <h3 id="{{- path.Base .RelPermalink -}}"><a href="{{- .Permalink -}}">{{- .Title -}}</a></h3>
                    </div>
                  </div>
                  <div class="grid-row">
                    <div class="grid-col-12 tablet-lg:grid-col-10">

                      {{/* Pass the $resources_by_topic to the collection template */}}
                      {{- partial "core/collection.html" (dict "list" $resources_by_topic) -}}

                    </div>
                  </div>
                  <footer>
                    <div class="grid-row">
                      <div class="grid-col-12">
                        <p class="more">
                          <a href="{{- .Permalink -}}">
                            <span>More on {{ .Title -}}</span>
                            <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                              <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zM4 12c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8-8-3.58-8-8zm12 0-4 4-1.41-1.41L12.17 13H8v-2h4.17l-1.59-1.59L12 8l4 4z"/>
                            </svg>
                          </a>
                        </p>
                      </div>
                    </div>
                  </footer>
                </div>
                {{- end -}}
              {{ end }}
            {{ end }}
          </div>

          <div class="grid-col-12 tablet:grid-col-3 tablet:order-first">
            <nav class="toc">
              <ul>

                {{/* Gets all the pages in the /topics directory */}}
                {{- with ($.Site.GetPage (printf "/%s" "topics")) -}}

                  {{/* Get only the pages that are greater than or equal to 2 */}}
                  {{- $topics_featured := (where .Pages ".Params.weight" "ge" 2 ) -}}

                  {{/* Loop through all the topics... */}}
                  {{ range $name, $taxonomy := $topics_featured }}

                    {{/* Get all resource pages with this current taxonomy */}}
                    {{- $resources_by_topic := (where .Pages "Section" "resources") -}}
                    {{- if $resources_by_topic -}}
                      {{- $slug := .RelPermalink -}}
                      <li><a href="#{{- path.Base .RelPermalink -}}"><span>{{- .Title -}}</span></a></li>
                    {{- end -}}
                  {{- end -}}
                {{- end -}}

              </ul>
            </nav>
            <p class="more">
              <a href="{{- "/topics" | absURL -}}"><span>See all topics</span>
                <!-- <i class="fas fa-arrow-circle-right"></i> -->
                <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zM4 12c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8-8-3.58-8-8zm12 0-4 4-1.41-1.41L12.17 13H8v-2h4.17l-1.59-1.59L12 8l4 4z"/>
                </svg>
              </a>
            </p>
          </div>

        </div>
      </div>
    </section>



    <section class="topic-buttons">
      <div class="grid-container grid-container-desktop">
        <div class="grid-row">
          <div class="grid-col-12">
            <h2>Resources by Topic</h2>
          </div>
        </div>
        <div class="grid-row tablet:grid-gap-2">
          {{- $top_topics := $.Site.Taxonomies.topics -}}
          {{- range $name, $taxonomy := $top_topics -}}
            {{- with $.Site.GetPage (printf "/topics/%s" $name) -}}
              {{- if or (eq .Params.weight 2) (eq .Params.weight 3) -}}
                <div class="grid-col-12 tablet:grid-col-4">
                  <div class="topic" data-edit-this="{{- $path -}}">
                    <h3>
                      <a href="{{- .Permalink | absURL -}}" title="{{- .Title -}}">{{- .Title -}} <span>&#8594;</span></a>
                    </h3>
                  </div>
                </div>
              {{- end -}}
            {{- end -}}
          {{- end -}}
        </div>
        <footer>
          <div class="grid-row tablet-lg:grid-gap-2">
            <div class="grid-col-12">
              <p class="more">
                <a href="/topics">
                  <span>See all topics</span>
                  <svg class="usa-icon" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zM4 12c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8-8-3.58-8-8zm12 0-4 4-1.41-1.41L12.17 13H8v-2h4.17l-1.59-1.59L12 8l4 4z"/>
                  </svg>
                </a>
              </p>
            </div>
          </div>
        </footer>
      </div>
    </section>

  </article>
</main>

{{- end -}}
